<?php
namespace WpIntegrity\StoreKit\Admin;

/**
 * Admin Pages Handler
 */
class Settings {

    private $settings_api;

    public function __construct() {
        add_action( 'admin_menu', [ $this, 'admin_menu' ] );
    }

    /**
     * Register our menu page
     *
     * @return void
     */
    public function admin_menu() {
        global $submenu;

        $capability = 'manage_options';
        $slug       = 'storekit';

        $storekit_icon_base64 = 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI3LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe29wYWNpdHk6MC45Nzg7ZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Qxe29wYWNpdHk6MC45OTg7ZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cjwvc3R5bGU+CjxnPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTg2LjUtMC41YzExMi43LDAsMjI1LjMsMCwzMzgsMGMxNiw0LjUsMjYuMiwxNC44LDMwLjUsMzFjMC4zLDU1LDAuNywxMTAsMSwxNjVjMTAuNywxMC40LDIxLDIxLDMxLDMyCgkJYzAuOSwxMS4xLDAuNiwyMi4xLTEsMzNjLTIuOCw3LjgtNy40LDE0LjEtMTQsMTljLTAuNSw2MS43LTAuNywxMjMuMy0wLjUsMTg1YzE2LjQsNC43LDI0LjQsMTUuNywyNCwzM2MtMC4yLDMuMy0wLjMsNi43LTAuNSwxMAoJCWMtMC43LDEuOS0xLjksMy4yLTMuNSw0Yy0xNTcuMywwLTMxNC43LDAtNDcyLDBjLTEuNi0wLjgtMi44LTIuMS0zLjUtNGMtMy44LTE3LjIsMS4zLTMwLjcsMTUuNS00MC41YzIuNS0xLjMsNS4yLTIuMiw4LTIuNQoJCWMwLjItNjEuNywwLTEyMy4zLTAuNS0xODVjLTYuNi00LjktMTEuMi0xMS4yLTE0LTE5Yy0xLjYtMTAuOS0xLjktMjEuOS0xLTMzYzEwLTExLDIwLjMtMjEuNiwzMS0zMmMwLjMtNTUsMC43LTExMCwxLTE2NQoJCUM2MC4zLDE0LjMsNzAuNSw0LDg2LjUtMC41eiBNOTUuNSwxNS41YzEwNi43LTAuMiwyMTMuMywwLDMyMCwwLjVjMTQuMSwxLjUsMjIsOS4zLDIzLjUsMjMuNWMwLjUsNTAuNywwLjcsMTAxLjMsMC41LDE1MgoJCWMtMTYsMC0zMiwwLTQ4LDBjLTAuMi0yNiwwLTUyLDAuNS03OGMyLjMtNyw0LjctMTQsNy0yMWMwLjctMy4zLDAuNy02LjcsMC0xMGMtMy45LTE2LjUtOC4yLTMyLjgtMTMtNDljLTAuOC0wLjYtMS42LTEuMS0yLjUtMS41CgkJYy0xMC43LTAuNy0yMS4zLTAuNy0zMiwwYy0wLjksMC40LTEuOCwwLjktMi41LDEuNWMtNC44LDE2LjItOS4xLDMyLjUtMTMsNDljLTAuNywzLjMtMC43LDYuNywwLDEwYzIuMyw3LDQuNywxNCw3LDIxCgkJYzAuNSwyNiwwLjcsNTIsMC41LDc4Yy0yMCwwLTQwLDAtNjAsMGMtMC4zLTIwLDAtNDAsMS02MGMyNS4xLTE3LjQsMzIuOS00MC43LDIzLjUtNzBjLTYuMy0xNS4xLTE3LjEtMjUuMS0zMi41LTMwCgkJYy0zLjUtMC4zLTYsMS03LjUsNGMtMC41LDEzLTAuNywyNi0wLjUsMzljLTgsMC0xNiwwLTI0LDBjMC4yLTEzLDAtMjYtMC41LTM5Yy0xLjUtMy00LTQuMy03LjUtNGMtMTkuNyw2LjctMzEuNSwyMC4zLTM1LjUsNDEKCQljLTMuNiwyNS40LDUuMiw0NS4xLDI2LjUsNTljMSwyMCwxLjMsNDAsMSw2MGMtMjAsMC00MCwwLTYwLDBjLTAuMi0yNiwwLTUyLDAuNS03OGMyLjMtNyw0LjctMTQsNy0yMWMwLjctMywwLjctNiwwLTkKCQljLTguMi0xNy4yLTE3LTM0LjEtMjYuNS01MC41Yy00LjgtMi40LTktMS42LTEyLjUsMi41Yy04LDE2LTE2LDMyLTI0LDQ4Yy0wLjcsMy0wLjcsNiwwLDljMi4zLDcsNC43LDE0LDcsMjFjMC41LDI2LDAuNyw1MiwwLjUsNzgKCQljLTE2LDAtMzIsMC00OCwwYy0wLjItNTAuNywwLTEwMS4zLDAuNS0xNTJDNzMuNywyNS4zLDgxLjUsMTcuMyw5NS41LDE1LjV6IE0zNjIuNSw0Ny41YzMuNi0wLjMsNy4xLDAsMTAuNSwxCgkJYzMuMiwxMi43LDYuMywyNS4zLDkuNSwzOGMtMS45LDUuNi0zLjUsMTEuMy01LDE3Yy02LjcsMC0xMy4zLDAtMjAsMGMtMS41LTUuNy0zLjEtMTEuNC01LTE3QzM1NS43LDczLjQsMzU5LDYwLjQsMzYyLjUsNDcuNXoKCQkgTTIyNi41LDU2LjVjMC44LDEwLjIsMS4zLDIwLjUsMS41LDMxYzEuMiwxLjUsMi43LDIuNyw0LjUsMy41YzE2LjEsMSwzMi4xLDAuNiw0OC0xYzAuOC0wLjgsMS43LTEuNywyLjUtMi41CgkJYzAuMy0xMC4zLDAuNy0yMC43LDEtMzFjOS4yLDkuOSwxMi41LDIxLjYsMTAsMzVjLTMuOSwxMy4zLTEyLDIyLjgtMjQuNSwyOC41Yy0wLjYsMC44LTEuMSwxLjYtMS41LDIuNWMtMC41LDIzLTAuNyw0Ni0wLjUsNjkKCQljLTgsMC0xNiwwLTI0LDBjMC4yLTIzLDAtNDYtMC41LTY5Yy01LjMtNC0xMC42LTgtMTYtMTJjLTEyLTE0LjktMTMuNy0zMC45LTUtNDhDMjIzLjMsNjAuMywyMjQuOCw1OC4zLDIyNi41LDU2LjV6IE0xNDIuNSw1OS41CgkJYzAuOS0wLjEsMS41LDAuMiwyLDFjNC41LDkuMiw5LjIsMTguNCwxNCwyNy41Yy0yLjIsNS0zLjgsMTAuMi01LDE1LjVjLTYuNywwLTEzLjMsMC0yMCwwYy0xLjItNS4zLTIuOC0xMC41LTUtMTUuNQoJCUMxMzMuNiw3OC43LDEzOC4yLDY5LjIsMTQyLjUsNTkuNXogTTEzNS41LDExOS41YzUuMywwLDEwLjcsMCwxNiwwYzAsMjQsMCw0OCwwLDcyYy01LjMsMC0xMC43LDAtMTYsMAoJCUMxMzUuNSwxNjcuNSwxMzUuNSwxNDMuNSwxMzUuNSwxMTkuNXogTTM1OS41LDExOS41YzUuMywwLDEwLjcsMCwxNiwwYzAsMjQsMCw0OCwwLDcyYy01LjMsMC0xMC43LDAtMTYsMAoJCUMzNTkuNSwxNjcuNSwzNTkuNSwxNDMuNSwzNTkuNSwxMTkuNXogTTY3LjUsMjA3LjVjMTI1LjMtMC4yLDI1MC43LDAsMzc2LDAuNWM1LDUsMTAsMTAsMTUsMTVjLTEzNS4zLDAuNy0yNzAuNywwLjctNDA2LDAKCQlDNTcuNywyMTgsNjIuNywyMTIuOCw2Ny41LDIwNy41eiBNMzkuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMGMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNUM0OC41LDI3MSwzOC41LDI2MC44LDM5LjUsMjM5LjV6CgkJIE0xMDMuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMGMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNUMxMTIuNSwyNzEsMTAyLjUsMjYwLjgsMTAzLjUsMjM5LjV6IE0xNjcuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMAoJCWMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNUMxNzYuNSwyNzEsMTY2LjUsMjYwLjgsMTY3LjUsMjM5LjV6IE0yMzEuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMGMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNQoJCUMyNDAuNSwyNzEsMjMwLjUsMjYwLjgsMjMxLjUsMjM5LjV6IE0yOTUuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMGMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNUMzMDQuNSwyNzEsMjk0LjUsMjYwLjgsMjk1LjUsMjM5LjV6CgkJIE0zNTkuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMGMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNUMzNjguNSwyNzEsMzU4LjUsMjYwLjgsMzU5LjUsMjM5LjV6IE00MjMuNSwyMzkuNWMxNiwwLDMyLDAsNDgsMAoJCWMxLjUsMTQuOC00LjUsMjUtMTgsMzAuNUM0MzIuNSwyNzEsNDIyLjUsMjYwLjgsNDIzLjUsMjM5LjV6IE05NC41LDI3Mi41YzE0LjIsMTUuMywzMS4yLDE5LjEsNTEsMTEuNWM1LjYtMi42LDEwLjMtNi41LDE0LTExLjUKCQljMTMuOCwxNS41LDMwLjUsMTkuMyw1MCwxMS41YzUuNi0yLjYsMTAuMy02LjUsMTQtMTEuNWMxMiwxMy45LDI3LDE4LjQsNDUsMTMuNWM3LjYtMi44LDEzLjktNy4zLDE5LTEzLjVjMTIsMTMuOSwyNywxOC40LDQ1LDEzLjUKCQljNy42LTIuOCwxMy45LTcuMywxOS0xMy41YzE0LjcsMTUuOSwzMiwxOS40LDUyLDEwLjVjNC44LTIuNiw4LjgtNi4xLDEyLTEwLjVjMTAuNSwxMi4yLDIzLjgsMTcuMiw0MCwxNWMwLDU4LjcsMCwxMTcuMywwLDE3NgoJCWMtODUuMywwLTE3MC43LDAtMjU2LDBjMC4yLTM1LjcsMC03MS4zLTAuNS0xMDdjLTEwLjctMzUtMzQuMi00OS41LTcwLjUtNDMuNWMtMjEuNiw2LjktMzUuMSwyMS40LTQwLjUsNDMuNQoJCWMtMC41LDM1LjctMC43LDcxLjMtMC41LDEwN2MtMTAuNywwLTIxLjMsMC0zMiwwYzAtNTguNywwLTExNy4zLDAtMTc2YzEyLjYsMS45LDIzLjktMSwzNC04LjVDOTEuOCwyNzcuMiw5My41LDI3NS4xLDk0LjUsMjcyLjV6CgkJIE0xMzUuNSwzMjguNWMyNC0yLjIsMzkuNSw4LjIsNDYuNSwzMWMxLjMsMTAuNiwxLjgsMjEuMywxLjUsMzJjLTQtMC4yLTgsMC0xMiwwLjVjLTMsMS41LTQuMyw0LTQsNy41Yy0wLjEsMi40LDAuNiw0LjYsMiw2LjUKCQljNC41LDEuNCw5LjIsMS45LDE0LDEuNWMwLDE4LjcsMCwzNy4zLDAsNTZjLTI2LjcsMC01My4zLDAtODAsMGMtMC40LTM0LjcsMC4xLTY5LjQsMS41LTEwNEMxMDkuMywzNDMuMywxMTkuNSwzMzMsMTM1LjUsMzI4LjV6CgkJIE00Ny41LDQ3OS41YzEzOC43LTAuMiwyNzcuMywwLDQxNiwwLjVjOS4zLDEuMSwxNC4zLDYuMywxNSwxNS41Yy0xNDguNywwLTI5Ny4zLDAtNDQ2LDBDMzMuNCw0ODYuMywzOC40LDQ4MC45LDQ3LjUsNDc5LjV6Ii8+CjwvZz4KPGc+Cgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMjM1LjUsMzExLjVjNjIuMS0wLjUsMTI0LjEsMCwxODYsMS41YzAuNiwwLjgsMS4xLDEuNiwxLjUsMi41YzAuMiwyMCwwLjMsNDAsMC41LDYwCgkJYzAuMiwyMC44LTAuMyw0MS40LTEuNSw2MmMtMC44LDAuNi0xLjYsMS4xLTIuNSwxLjVjLTMwLjcsMC4yLTYxLjMsMC4zLTkyLDAuNWMtMzEuNCwwLjItNjIuOC0wLjMtOTQtMS41CgkJYy0wLjYtMC44LTEuMS0xLjYtMS41LTIuNWMtMC43LTQwLTAuNy04MCwwLTEyMEMyMzIuNywzMTMuNiwyMzMuOSwzMTIuMywyMzUuNSwzMTEuNXogTTI0Ny41LDMyNy41YzAsMTMuMywwLDI2LjcsMCw0MAoJCWMyNCwwLDQ4LDAsNzIsMGMwLTEzLjMsMC0yNi43LDAtNDBDMjk1LjUsMzI3LjUsMjcxLjUsMzI3LjUsMjQ3LjUsMzI3LjV6IE0zMzUuNSwzMjcuNWMwLDEzLjMsMCwyNi43LDAsNDBjMjQsMCw0OCwwLDcyLDAKCQljMC0xMy4zLDAtMjYuNywwLTQwQzM4My41LDMyNy41LDM1OS41LDMyNy41LDMzNS41LDMyNy41eiBNMjQ3LjUsMzgzLjVjMCwxMy4zLDAsMjYuNywwLDQwYzI0LDAsNDgsMCw3MiwwYzAtMTMuMywwLTI2LjcsMC00MAoJCUMyOTUuNSwzODMuNSwyNzEuNSwzODMuNSwyNDcuNSwzODMuNXogTTMzNS41LDM4My41YzAsMTMuMywwLDI2LjcsMCw0MGMyNCwwLDQ4LDAsNzIsMGMwLTEzLjMsMC0yNi43LDAtNDAKCQlDMzgzLjUsMzgzLjUsMzU5LjUsMzgzLjUsMzM1LjUsMzgzLjV6Ii8+CjwvZz4KPC9zdmc+Cg==';

        $storekit_icon_data_uri = 'data:image/svg+xml;base64,' . $storekit_icon_base64;

        $hook = add_menu_page( __( 'StoreKit', 'storekit' ), __( 'StoreKit', 'storekit' ), $capability, $slug, [ $this, 'render_settings_page' ], $storekit_icon_data_uri );

        add_action( 'admin_enqueue_scripts', [ $this, 'enqueue_scripts' ] );
    }

    /**
     * Render Plugin's Menu Page
     * 
     * @return void
     */
    public function render_settings_page() {
        echo '<div class="wrap"><div id="storekit-admin"></div></div>';
    }

    /**
     * Enqueue scripts
     * 
     * @return void
     */
    public function enqueue_scripts() {
        wp_enqueue_style( 'storekit-admin' );
        wp_enqueue_script( 'storekit-admin' );

        // Localize script to pass nonce to JavaScript
        wp_localize_script( 'storekit-admin', 'storekitApiSettings', array(
            'nonce' => wp_create_nonce( 'wp_rest' ),
        ));
    }
}
